<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Детали товара - BADDvisor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { padding-top: 80px; }
        .product-hero { background: linear-gradient(to right, #f8f9fa, #fff); padding: 40px 0; }
        .spec-card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .benefit-item { display: flex; align-items: flex-start; margin-bottom: 15px; }
        .benefit-icon { color: #4a6fa5; margin-right: 15px; font-size: 1.2rem; }
        .back-to-catalog { position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="index.html">
                <i class="bi bi-capsule me-2"></i>BADDvisor
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Главная</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="catalog.html">Каталог</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="assistant.html">ИИ-ассистент</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="cart.html">
                            <i class="bi bi-cart3"></i> Корзина
                            <span id="cartCounter" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Хлебные крошки -->
    <div class="container mt-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Главная</a></li>
                <li class="breadcrumb-item"><a href="catalog.html">Каталог</a></li>
                <li class="breadcrumb-item active" id="productBreadcrumb">Загрузка...</li>
            </ol>
        </nav>
    </div>

    <!-- Детали товара -->
    <div class="container" id="productDetails">
        <!-- Товар загружается через JS -->
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Загрузка...</span>
            </div>
            <p class="mt-3">Загружаем информацию о товаре...</p>
        </div>
    </div>

    <!-- Кнопка назад в каталог -->
    <div class="back-to-catalog">
        <a href="catalog.html" class="btn btn-primary btn-lg shadow" title="Вернуться в каталог">
            <i class="bi bi-arrow-left-circle"></i>
        </a>
    </div>

    <!-- Футер -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">
                <small>© 2024 Демо-проект BADDvisor. Все данные вымышлены.</small>
            </p>
        </div>
    </footer>

    <!-- Скрипты -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/products.js"></script>
    <script src="js/cart.js"></script>
    <script>
        // Получаем ID товара из URL
        function getProductIdFromURL() {
            const params = new URLSearchParams(window.location.search);
            return parseInt(params.get('id')) || 1;
        }

        // Загрузка деталей товара
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCounter();
            loadProductDetails();
        });

        function updateCartCounter() {
            if (window.cart && cart.updateCounter) {
                cart.updateCounter();
            }
        }

        function loadProductDetails() {
            const productId = getProductIdFromURL();
            const product = Products.getById(productId);
            
            if (!product) {
                document.getElementById('productDetails').innerHTML = `
                    <div class="alert alert-danger text-center py-5">
                        <h4>Товар не найден</h4>
                        <p>Товар с ID ${productId} не существует в нашем каталоге</p>
                        <a href="catalog.html" class="btn btn-primary mt-3">Вернуться в каталог</a>
                    </div>
                `;
                return;
            }
            
            // Обновляем хлебные крошки
            document.getElementById('productBreadcrumb').textContent = product.name;
            
            // Получаем связанные товары
            const relatedProducts = getRelatedProducts(product);
            
            // Формируем HTML
            document.getElementById('productDetails').innerHTML = `
                <!-- Основная информация -->
                <div class="product-hero rounded mb-5">
                    <div class="row align-items-center">
                        <div class="col-lg-5 mb-4 mb-lg-0">
                            <div class="text-center">
                                <img src="${product.image}" 
                                     class="img-fluid rounded shadow" 
                                     alt="${product.name}"
                                     style="max-height: 350px; object-fit: contain;">
                            </div>
                        </div>
                        <div class="col-lg-7">
                            <h1 class="display-5 fw-bold mb-3">${product.name}</h1>
                            <p class="lead text-muted mb-4">${product.description}</p>
                            
                            <div class="mb-4">
                                ${product.tags.map(tag => 
                                    `<span class="badge-tag fs-6">${tag}</span>`
                                ).join('')}
                            </div>
                            
                            <div class="d-flex align-items-center mb-4">
                                <span class="display-4 fw-bold text-primary me-4">${product.price} ₽</span>
                                <div>
                                    <button class="btn btn-primary btn-lg px-5" onclick="addToCart(${product.id})">
                                        <i class="bi bi-cart-plus me-2"></i>Добавить в корзину
                                    </button>
                                    <button class="btn btn-outline-primary btn-lg ms-2" onclick="addToCartWithNotification(${product.id})">
                                        <i class="bi bi-bag-check me-2"></i>Купить сейчас
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="benefit-item">
                                        <div class="benefit-icon"><i class="bi bi-truck"></i></div>
                                        <div>
                                            <strong>Бесплатная доставка</strong>
                                            <div class="text-muted small">При заказе от 3000 ₽</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="benefit-item">
                                        <div class="benefit-icon"><i class="bi bi-shield-check"></i></div>
                                        <div>
                                            <strong>Гарантия качества</strong>
                                            <div class="text-muted small">Официальный поставщик</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Описание и характеристики -->
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Описание -->
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <h3 class="card-title mb-4">
                                    <i class="bi bi-info-circle text-primary me-2"></i>Подробное описание
                                </h3>
                                <div class="card-text">
                                    ${getFullDescription(product)}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Действие -->
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <h3 class="card-title mb-4">
                                    <i class="bi bi-check2-circle text-primary me-2"></i>Действие и эффекты
                                </h3>
                                <div class="row">
                                    ${getEffectsHTML(product.tags)}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Связанные товары -->
                        ${relatedProducts.length > 0 ? `
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <h3 class="card-title mb-4">
                                    <i class="bi bi-arrow-left-right text-primary me-2"></i>Похожие товары
                                </h3>
                                <div class="row">
                                    ${relatedProducts.map(related => `
                                        <div class="col-md-6 mb-3">
                                            <div class="product-card h-100">
                                                <a href="product-details.html?id=${related.id}" class="text-decoration-none text-dark">
                                                    <img src="${related.image}" class="card-img-top" alt="${related.name}" style="height: 150px; object-fit: cover;">
                                                    <div class="p-3">
                                                        <h6 class="card-title">${related.name}</h6>
                                                        <p class="card-text text-muted small mb-2">${related.description}</p>
                                                        <div class="mb-2">
                                                            ${related.tags.slice(0, 2).map(tag => 
                                                                `<span class="badge-tag">${tag}</span>`
                                                            ).join('')}
                                                        </div>
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <span class="fw-bold">${related.price} ₽</span>
                                                            <button class="btn btn-sm btn-primary" onclick="addToCartFromDetails(${related.id}); event.preventDefault();">
                                                                <i class="bi bi-cart-plus"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Характеристики -->
                        <div class="spec-card sticky-top" style="top: 100px;">
                            <h3 class="mb-4">
                                <i class="bi bi-card-checklist text-primary me-2"></i>Характеристики
                            </h3>
                            
                            <table class="table table-borderless">
                                <tbody>
                                    <tr>
                                        <td class="text-muted" style="width: 40%">Категория:</td>
                                        <td class="fw-medium">${getCategoryName(product.category)}</td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="text-muted">Основное действие:</td>
                                        <td class="fw-medium">${product.tags[0] || 'Поддержка здоровья'}</td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="text-muted">Рекомендация:</td>
                                        <td class="fw-medium">${getRecommendationText(product.tags)}</td>
                                    </tr>
                                    
                                    ${getCompositionText(product.tags)}
                                    
                                    <tr>
                                        <td class="text-muted">Форма выпуска:</td>
                                        <td class="fw-medium">${getFormText(product.tags)}</td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="text-muted">Количество:</td>
                                        <td class="fw-medium">${getQuantityText(product.tags)}</td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="text-muted">Способ применения:</td>
                                        <td class="fw-medium">${getUsageText(product.tags)}</td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="text-muted">Производитель:</td>
                                        <td class="fw-medium">BADDvisor Labs</td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="text-muted">Срок годности:</td>
                                        <td class="fw-medium">24 месяца</td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="text-muted">Условия хранения:</td>
                                        <td class="fw-medium">При температуре до 25°C</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div class="mt-4">
                                <a href="assistant.html" class="btn btn-outline-primary w-100 mb-3">
                                    <i class="bi bi-robot me-2"></i>Спросить у ИИ-ассистента
                                </a>
                                
                                <button class="btn btn-primary w-100 mb-2" onclick="addToCart(${product.id})">
                                    <i class="bi bi-cart-plus me-2"></i>Добавить в корзину
                                </button>
                                
                                <button class="btn btn-success w-100" onclick="addToCartWithNotification(${product.id})">
                                    <i class="bi bi-bag-check me-2"></i>Купить сейчас
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Важное предупреждение -->
                <div class="alert alert-warning mt-5">
                    <div class="d-flex">
                        <i class="bi bi-exclamation-triangle fs-4 me-3"></i>
                        <div>
                            <h5 class="alert-heading">Важная информация</h5>
                            <p class="mb-0">
                                <strong>Демонстрационный проект.</strong> Все данные вымышлены. Не является медицинской рекомендацией. 
                                Перед применением БАДов проконсультируйтесь с врачом. БАД не является лекарственным средством.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Вспомогательные функции
        function getFullDescription(product) {
            const descriptions = {
                'stress': `${product.name} — это специально разработанная формула для поддержки нервной системы в условиях повышенного стресса. Содержит компоненты, способствующие расслаблению и улучшению эмоционального состояния.`,
                'sleep': `${product.name} создан для нормализации цикла сна и бодрствования. Способствует легкому засыпанию, глубокому сну и легкому пробуждению.`,
                'energy': `${product.name} — это источник энергии и бодрости. Помогает преодолеть усталость, повысить работоспособность и улучшить общий тонус организма.`,
                'immunity': `${product.name} разработан для укрепления иммунной системы. Помогает организму противостоять инфекциям и быстрее восстанавливаться после болезней.`,
                'detox': `${product.name} способствует очищению организма от токсинов, поддерживает функцию печени и улучшает обмен веществ.`,
                'joints': `${product.name} предназначен для поддержки здоровья суставов. Способствует уменьшению дискомфорта и улучшению подвижности.`,
                'digestion': `${product.name} помогает нормализовать работу желудочно-кишечного тракта, улучшает пищеварение и способствует поддержанию здоровой микрофлоры.`
            };
            
            return descriptions[product.category] || 
                   `${product.name} — это высококачественная биологически активная добавка, разработанная для поддержки здоровья и улучшения самочувствия. ${product.description}`;
        }

        function getEffectsHTML(tags) {
            const effects = {
                'магний': 'Снижает нервное напряжение, улучшает сон',
                'мелатонин': 'Регулирует циркадные ритмы, улучшает качество сна',
                'энергия': 'Повышает работоспособность, снижает усталость',
                'иммунитет': 'Укрепляет защитные силы организма',
                'витамин C': 'Антиоксидантная защита, поддержка иммунитета',
                'цинк': 'Участвует в иммунных процессах',
                'пробиотик': 'Восстанавливает микрофлору кишечника',
                'суставы': 'Поддерживает здоровье хрящевой ткани',
                'коллаген': 'Улучшает состояние кожи и суставов',
                'омега-3': 'Противостоит воспалительным процессам',
                'пищеварение': 'Улучшает работу ЖКТ',
                'детокс': 'Способствует очищению организма',
                'стресс': 'Помогает справляться со стрессом',
                'сон': 'Улучшает качество и продолжительность сна',
                'концентрация': 'Повышает умственную работоспособность'
            };
            
            // Берем только те эффекты, которые есть в тегах продукта
            const relevantEffects = tags
                .filter(tag => effects[tag])
                .map(tag => effects[tag])
                .slice(0, 6);
            
            // Если не нашли подходящих эффектов, используем общие
            if (relevantEffects.length === 0) {
                return `
                    <div class="col-md-6 mb-3">
                        <div class="d-flex align-items-center p-3 bg-light rounded">
                            <i class="bi bi-check-lg text-success fs-5 me-3"></i>
                            <span class="fw-medium">Поддержка общего здоровья</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex align-items-center p-3 bg-light rounded">
                            <i class="bi bi-check-lg text-success fs-5 me-3"></i>
                            <span class="fw-medium">Улучшение самочувствия</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex align-items-center p-3 bg-light rounded">
                            <i class="bi bi-check-lg text-success fs-5 me-3"></i>
                            <span class="fw-medium">Восполнение дефицита нутриентов</span>
                        </div>
                    </div>
                `;
            }
            
            return relevantEffects.map(effect => `
                <div class="col-md-6 mb-3">
                    <div class="d-flex align-items-center p-3 bg-light rounded">
                        <i class="bi bi-check-lg text-success fs-5 me-3"></i>
                        <span class="fw-medium">${effect}</span>
                    </div>
                </div>
            `).join('');
        }

        function getCategoryName(category) {
            const categories = {
                'stress': 'Антистресс и нервы',
                'sleep': 'Сон и релаксация',
                'energy': 'Энергия и бодрость',
                'immunity': 'Иммунитет',
                'detox': 'Детокс и очищение',
                'joints': 'Суставы и кости',
                'digestion': 'Пищеварение'
            };
            return categories[category] || 'Общая поддержка';
        }

        function getRecommendationText(tags) {
            if (tags.includes('сон') || tags.includes('бессонница')) return 'При нарушениях сна, трудностях с засыпанием';
            if (tags.includes('стресс') || tags.includes('нервы')) return 'При стрессе, тревожности, нервном напряжении';
            if (tags.includes('энергия') || tags.includes('усталость')) return 'При хронической усталости, снижении энергии';
            if (tags.includes('иммунитет') || tags.includes('простуда')) return 'Для укрепления иммунитета, профилактики простуд';
            if (tags.includes('пищеварение') || tags.includes('желудок')) return 'При проблемах с пищеварением, дискомфорте в ЖКТ';
            if (tags.includes('суставы') || tags.includes('артрит')) return 'При болях в суставах, снижении подвижности';
            return 'Для общего укрепления здоровья и улучшения самочувствия';
        }

        function getCompositionText(tags) {
            if (tags.includes('магний')) return `
                <tr>
                    <td class="text-muted">Основной компонент:</td>
                    <td class="fw-medium">Магний хелат (высокая биодоступность)</td>
                </tr>
            `;
            if (tags.includes('мелатонин')) return `
                <tr>
                    <td class="text-muted">Основной компонент:</td>
                    <td class="fw-medium">Мелатонин (гормон сна)</td>
                </tr>
            `;
            if (tags.includes('витамин C')) return `
                <tr>
                    <td class="text-muted">Основной компонент:</td>
                    <td class="fw-medium">Витамин C (аскорбиновая кислота)</td>
                </tr>
            `;
            if (tags.includes('коэнзим')) return `
                <tr>
                    <td class="text-muted">Основной компонент:</td>
                    <td class="fw-medium">Коэнзим Q10 (убихинон)</td>
                </tr>
            `;
            if (tags.includes('коллаген')) return `
                <tr>
                    <td class="text-muted">Основной компонент:</td>
                    <td class="fw-medium">Морской коллаген I и III типа</td>
                </tr>
            `;
            return `
                <tr>
                    <td class="text-muted">Состав:</td>
                    <td class="fw-medium">Комплекс натуральных компонентов</td>
                </tr>
            `;
        }

        function getFormText(tags) {
            if (tags.includes('магний') || tags.includes('витамин')) return 'Таблетки';
            if (tags.includes('мелатонин') || tags.includes('коэнзим')) return 'Капсулы';
            if (tags.includes('омега-3') || tags.includes('коллаген')) return 'Мягкие капсулы';
            return 'Капсулы';
        }

        function getQuantityText(tags) {
            if (tags.includes('магний') || tags.includes('мелатонин')) return '60 таблеток';
            if (tags.includes('витамин C') || tags.includes('коэнзим')) return '90 капсул';
            if (tags.includes('омега-3')) return '120 мягких капсул';
            return '60 капсул';
        }

        function getUsageText(tags) {
            if (tags.includes('сон') || tags.includes('мелатонин')) return '1 таблетка за 30-60 минут до сна';
            if (tags.includes('энергия') || tags.includes('коэнзим')) return '1 капсула утром во время еды';
            if (tags.includes('иммунитет') || tags.includes('витамин C')) return '1-2 таблетки в день с пищей';
            return '1-2 капсулы в день во время еды';
        }

        function getRelatedProducts(product) {
            const allProducts = Products.getAll();
            // Ищем товары с теми же тегами или той же категорией
            return allProducts
                .filter(p => p.id !== product.id) // Исключаем текущий товар
                .filter(p => 
                    p.category === product.category || // Та же категория
                    p.tags.some(tag => product.tags.includes(tag)) // Общие теги
                )
                .slice(0, 2); // Максимум 2 товара
        }

        function addToCart(productId) {
            if (window.cart) {
                window.cart.add(productId);
                updateCartCounter();
            }
        }

        function addToCartWithNotification(productId) {
            if (window.cart) {
                window.cart.add(productId);
                updateCartCounter();
                // Показываем специальное уведомление
                cart.showNotification(`
                    <strong>Товар добавлен в корзину!</strong><br>
                    <a href="cart.html" class="btn btn-sm btn-success mt-2">Перейти к оформлению</a>
                    <a href="catalog.html" class="btn btn-sm btn-outline-primary mt-2 ms-2">Продолжить покупки</a>
                `, 'success');
            }
        }

        function addToCartFromDetails(productId) {
            addToCart(productId);
            cart.showNotification('Товар добавлен в корзину!', 'success');
        }
    </script>
</body>
</html>
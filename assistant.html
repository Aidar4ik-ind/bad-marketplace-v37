<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç - BADDvisor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { padding-top: 80px; }
        .ai-header { background: linear-gradient(135deg, #4a6fa5 0%, #2c5282 100%); color: white; padding: 80px 0; }
        .chat-container { background: white; border-radius: 15px; padding: 20px; height: 400px; overflow-y: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .message { max-width: 85%; margin-bottom: 15px; padding: 12px 16px; border-radius: 18px; position: relative; animation: fadeIn 0.3s; }
        .user-message { background: #4a6fa5; color: white; margin-left: auto; border-bottom-right-radius: 5px; }
        .ai-message { background: #f0f2f5; color: #333; margin-right: auto; border-bottom-left-radius: 5px; }
        .symptom-chip { display: inline-block; background: #e3f2fd; color: #1976d2; padding: 8px 16px; margin: 5px; border-radius: 25px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .symptom-chip:hover, .symptom-chip.active { background: #1976d2; color: white; transform: translateY(-2px); border-color: #1976d2; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .typing-indicator { display: inline-block; }
        .typing-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #666; margin: 0 2px; animation: typing 1.4s infinite ease-in-out; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="index.html">
                <i class="bi bi-capsule me-2"></i>BADDvisor
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="assistant.html">–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="cart.html">
                            <i class="bi bi-cart3"></i> –ö–æ—Ä–∑–∏–Ω–∞
                            <span id="cartCounter" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- –®–∞–ø–∫–∞ –ò–ò -->
    <div class="ai-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">–£–º–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</h1>
                    <p class="lead mb-4">–û–ø–∏—à–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã, –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –ø–æ–¥–±–µ—Ä–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ë–ê–î—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è</p>
                    <div class="d-flex align-items-center">
                        <div class="bg-white text-primary rounded-circle p-3 me-3">
                            <i class="bi bi-robot fs-1"></i>
                        </div>
                        <div>
                            <h5 class="text-white mb-0">BADDvisor AI v2.0</h5>
                            <small class="text-white-50">–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 text-center">
                    <div class="bg-white rounded p-4 d-inline-block shadow">
                        <div class="fs-1 mb-3">ü§ñüíä</div>
                        <h5>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ò–ò?</h5>
                        <p class="text-muted mb-0">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç 100+ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏ –Ω–∞—Ö–æ–¥–∏—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ë–ê–î—ã –¥–ª—è –≤–∞—à–∏—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å–∏–º–ø—Ç–æ–º—ã -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-lightning-charge text-primary me-2"></i>–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã
                        </h5>
                        <div class="d-flex flex-wrap" id="symptomsContainer">
                            <div class="symptom-chip" data-symptom="—Å–æ–Ω">üò¥ –ü—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–Ω–æ–º</div>
                            <div class="symptom-chip" data-symptom="—Å—Ç—Ä–µ—Å—Å">üò∞ –°—Ç—Ä–µ—Å—Å –∏ —Ç—Ä–µ–≤–æ–≥–∞</div>
                            <div class="symptom-chip" data-symptom="—É—Å—Ç–∞–ª–æ—Å—Ç—å">üò© –£—Å—Ç–∞–ª–æ—Å—Ç—å –∏ —Å–ª–∞–±–æ—Å—Ç—å</div>
                            <div class="symptom-chip" data-symptom="–∏–º–º—É–Ω–∏—Ç–µ—Ç">ü§ß –ß–∞—Å—Ç—ã–µ –ø—Ä–æ—Å—Ç—É–¥—ã</div>
                            <div class="symptom-chip" data-symptom="–ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ">ü§¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ–º</div>
                            <div class="symptom-chip" data-symptom="—Å—É—Å—Ç–∞–≤—ã">ü¶µ –ë–æ–ª–∏ –≤ —Å—É—Å—Ç–∞–≤–∞—Ö</div>
                            <div class="symptom-chip" data-symptom="–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è">üß† –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–µ–π</div>
                            <div class="symptom-chip" data-symptom="–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ">üòî –ü–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
                        </div>
                    </div>
                </div>

                <!-- –ß–∞—Ç —Å –ò–ò -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-chat-dots text-primary me-2"></i>–ß–∞—Ç —Å –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º
                        </h5>
                        
                        <div class="chat-container mb-3" id="chatWindow">
                            <div class="message ai-message">
                                <strong>–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç:</strong> –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –ø–æ–º–æ–≥—É –ø–æ–¥–æ–±—Ä–∞—Ç—å –ë–ê–î—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç, –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã –≤—ã—à–µ.<br><br>
                                <small class="text-muted">–ü—Ä–∏–º–µ—Ä—ã: "–ü–ª–æ—Ö–æ —Å–ø–ª—é –ø–æ –Ω–æ—á–∞–º", "–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏ —Å—Ç—Ä–µ—Å—Å", "–ß–∞—Å—Ç–æ –±–æ–ª–µ—é –ø—Ä–æ—Å—Ç—É–¥–æ–π", "–ë–æ–ª—è—Ç —Å—É—Å—Ç–∞–≤—ã –∏ —Å–ø–∏–Ω–∞"</small>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <textarea class="form-control" 
                                      id="aiInput" 
                                      rows="2" 
                                      placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ —Å–∏–º–ø—Ç–æ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–ü–ª–æ—Ö–æ —Å–ø–ª—é —É–∂–µ –Ω–µ–¥–µ–ª—é –∏ —á—É–≤—Å—Ç–≤—É—é –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é —É—Å—Ç–∞–ª–æ—Å—Ç—å')"></textarea>
                            <button class="btn btn-primary" id="sendButton">
                                <i class="bi bi-send"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                            </button>
                        </div>
                        <div class="form-text mt-2">
                            –ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, Shift+Enter –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
                        </div>
                    </div>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                <div class="card border-0 shadow-sm" id="resultsCard" style="display: none;">
                    <div class="card-body">
                        <h5 class="card-title mb-4">
                            <i class="bi bi-star text-warning me-2"></i>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
                        </h5>
                        
                        <div id="aiExplanation" class="alert alert-info mb-4">
                            <!-- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ò–ò -->
                        </div>
                        
                        <div class="alert alert-warning mb-4">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>–í–∞–∂–Ω–æ:</strong> –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–æ—Å—è—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –≤—Ä–∞—á–∞. –ë–ê–î –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–æ–º.
                        </div>
                        
                        <h6 class="mb-3">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ë–ê–î—ã:</h6>
                        <div class="row" id="recommendedProducts">
                            <!-- –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã -->
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-success" id="addAllBtn" style="display: none;">
                                <i class="bi bi-cart-check me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
                            </button>
                        </div>
                    </div>
                </div>

                <!-- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ -->
                <div class="text-center mt-5">
                    <h6 class="text-muted mb-3">–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h6>
                    <div class="d-flex flex-wrap justify-content-center gap-2">
                        <button class="btn btn-sm btn-outline-primary" onclick="setExample('–ü–ª–æ—Ö–æ —Å–ø–ª—é —É–∂–µ –Ω–µ–¥–µ–ª—é, –ø—Ä–æ—Å—ã–ø–∞—é—Å—å –Ω–æ—á—å—é')">–ü—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–Ω–æ–º</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="setExample('–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Å—Ç—Ä–µ—Å—Å –Ω–∞ —Ä–∞–±–æ—Ç–µ, –Ω–µ—Ä–≤–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ')">–°—Ç—Ä–µ—Å—Å –∏ –Ω–µ—Ä–≤—ã</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="setExample('–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏ —Ü–µ–ª—ã–π –¥–µ–Ω—å, —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–ª–æ—Å—Ç—å')">–£—Å—Ç–∞–ª–æ—Å—Ç—å</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="setExample('–ß–∞—Å—Ç–æ –±–æ–ª–µ—é –ø—Ä–æ—Å—Ç—É–¥–æ–π, —Å–ª–∞–±—ã–π –∏–º–º—É–Ω–∏—Ç–µ—Ç')">–ò–º–º—É–Ω–∏—Ç–µ—Ç</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="setExample('–ë–æ–ª—è—Ç –∫–æ–ª–µ–Ω–∏ –∏ —Å–ø–∏–Ω–∞, —Ö—Ä—É—Å—Ç –≤ —Å—É—Å—Ç–∞–≤–∞—Ö')">–°—É—Å—Ç–∞–≤—ã</button>
                        <button class="btn btn-sm btn-outline-primary" onclick="setExample('–ü–ª–æ—Ö–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è, –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é')">–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="bg-dark text-white py-4">
        <div class="container text-center">
            <p class="mb-0">
                <small>¬© 2024 –î–µ–º–æ-–ø—Ä–æ–µ–∫—Ç BADDvisor. –£–ª—É—á—à–µ–Ω–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç v2.0</small>
            </p>
        </div>
    </footer>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/products.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/ai-rules.js"></script>
    <script>
        // –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è Mock –ò–ò (–±–∞–∑–æ–≤—ã–µ)
        const mockAIRules = {
            '—Å–æ–Ω': [1, 2, 26, 27, 30],
            '—Å–ø–∞—Ç—å': [1, 2],
            '–±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞': [1, 2],
            '—Å—Ç—Ä–µ—Å—Å': [1, 6, 7, 9, 25, 28, 29],
            '–Ω–µ—Ä–≤—ã': [1, 6, 7],
            '—Ç—Ä–µ–≤–æ–∂': [6, 7],
            '—É—Å—Ç–∞–ª–æ—Å—Ç—å': [3, 8, 9, 10, 24],
            '—ç–Ω–µ—Ä–≥–∏—è': [3, 8, 9, 10, 24],
            '—Å–∏–ª—ã': [3, 9],
            '–∏–º–º—É–Ω–∏—Ç–µ—Ç': [4, 11, 12, 13, 21],
            '–ø—Ä–æ—Å—Ç—É–¥–∞': [4, 11, 21],
            '–±–æ–ª–µ–∑–Ω—å': [4, 11],
            '–ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ': [5, 17, 18, 22, 23],
            '–∂–µ–ª—É–¥–æ–∫': [17, 18],
            '—Å—É—Å—Ç–∞–≤—ã': [14, 15, 16, 19, 20],
            '–∫–æ–ª–µ–Ω–∏': [14, 19],
            '—Å–ø–∏–Ω–∞': [14, 15],
            '–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è': [7, 24],
            '–ø–∞–º—è—Ç—å': [24],
            '–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ': [1, 6, 25],
            '–¥–µ—Ç–æ–∫—Å': [5, 22]
        };

        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–∞
        const aiRules = {
            ...mockAIRules,
            ...(window.aiRulesExtended || {})
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCounter();
            initAIAssistant();
        });

        function initAIAssistant() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–∏–ø–æ–≤ —Å–∏–º–ø—Ç–æ–º–æ–≤
            document.querySelectorAll('.symptom-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —á–∏–ø—ã
                    document.querySelectorAll('.symptom-chip').forEach(c => c.classList.remove('active'));
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π
                    this.classList.add('active');
                    
                    const symptom = this.getAttribute('data-symptom');
                    const text = this.textContent.replace(/[^\w\s]/g, '').trim();
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ —á–∞—Ç
                    addMessage(text, 'user');
                    
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å
                    setTimeout(() => {
                        processAIRequest(text);
                    }, 300);
                });
            });

            // –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
            document.getElementById('sendButton').addEventListener('click', sendMessage);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
            document.getElementById('aiInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('aiInput').focus();
        }

        function sendMessage() {
            const input = document.getElementById('aiInput').value.trim();
            if (!input) {
                cart.showNotification('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å', 'warning');
                return;
            }
            
            addMessage(input, 'user');
            document.getElementById('aiInput').value = '';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —á–∏–ø—ã
            document.querySelectorAll('.symptom-chip').forEach(c => c.classList.remove('active'));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingMsg = addTypingIndicator();
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏
            setTimeout(() => {
                // –£–¥–∞–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                loadingMsg.remove();
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å
                processAIRequest(input);
            }, 800 + Math.random() * 700); // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
        }

        function addMessage(text, sender) {
            const chatWindow = document.getElementById('chatWindow');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `message ${sender}-message fade-in`;
            messageDiv.innerHTML = `<strong>${sender === 'user' ? '–í—ã' : '–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç'}:</strong> ${text}`;
            
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            return messageDiv;
        }

        function addTypingIndicator() {
            const chatWindow = document.getElementById('chatWindow');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `message ai-message`;
            messageDiv.innerHTML = `
                <strong>–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç:</strong> 
                <span class="typing-indicator">
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                </span>
            `;
            
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            return messageDiv;
        }

        function processAIRequest(input) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∞–Ω–∞–ª–∏–∑–∞
            let analysis;
            let response;
            
            if (window.analyzeHealthRequest && window.generateAIResponse) {
                analysis = analyzeHealthRequest(input);
                response = generateAIResponse(analysis);
            } else {
                // –†–µ–∑–µ—Ä–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
                const inputLower = input.toLowerCase();
                const foundKeywords = [];
                const recommendedIds = new Set();
                
                Object.keys(aiRules).forEach(keyword => {
                    if (inputLower.includes(keyword)) {
                        foundKeywords.push(keyword);
                        aiRules[keyword].forEach(id => recommendedIds.add(id));
                    }
                });
                
                const products = Array.from(recommendedIds)
                    .map(id => Products.getById(id))
                    .filter(Boolean)
                    .slice(0, 6);
                
                response = {
                    message: foundKeywords.length > 0 
                        ? `–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —è –æ–ø—Ä–µ–¥–µ–ª–∏–ª —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã: ${foundKeywords.slice(0, 3).join(', ')}.`
                        : "–í–æ—Ç –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è:",
                    explanation: foundKeywords.length > 0 
                        ? `–ù–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: <strong>${foundKeywords.slice(0, 3).join(', ')}</strong>. –í–æ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ë–ê–î—ã:`
                        : "–í–æ—Ç –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:",
                    products: products.length > 0 ? products : Products.getFeatured(3)
                };
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –ò–ò –≤ —á–∞—Ç
            addMessage(response.message, 'ai');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            showRecommendations(response.products, response.explanation);
        }

        function showRecommendations(products, explanation) {
            document.getElementById('resultsCard').style.display = 'block';
            document.getElementById('aiExplanation').innerHTML = explanation;
            
            const container = document.getElementById('recommendedProducts');
            container.innerHTML = products.map(product => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="product-card h-100">
                        <img src="${product.image}" class="card-img-top" alt="${product.name}" style="height: 150px; object-fit: cover;">
                        <div class="p-3">
                            <h6 class="card-title">${product.name}</h6>
                            <p class="card-text text-muted small mb-2">${product.description}</p>
                            <div class="mb-2">
                                ${product.tags.slice(0, 2).map(tag => 
                                    `<span class="badge-tag">${tag}</span>`
                                ).join('')}
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="fw-bold">${product.price} ‚ÇΩ</span>
                                <button class="btn btn-sm btn-primary add-to-cart-btn" data-id="${product.id}">
                                    <i class="bi bi-cart-plus"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            const addAllBtn = document.getElementById('addAllBtn');
            if (products.length > 1) {
                addAllBtn.style.display = 'inline-block';
                addAllBtn.onclick = function() {
                    products.forEach(p => addToCartFromAI(p.id));
                    cart.showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${products.length} —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—É!`, 'success');
                };
            } else {
                addAllBtn.style.display = 'none';
            }
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
            document.getElementById('resultsCard').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        function setExample(text) {
            document.getElementById('aiInput').value = text;
            document.getElementById('aiInput').focus();
        }

        function addToCartFromAI(productId) {
            if (window.cart && window.cart.add) {
                window.cart.add(productId);
                updateCartCounter();
            }
        }

        function updateCartCounter() {
            if (window.cart && cart.updateCounter) {
                cart.updateCounter();
            }
        }
    </script>
</body>
</html>
